from scapy.all import IP, TCP, Raw, send
import random

def generate_malware_traffic(target_ip, target_port, payload):
    print(f"Generating simulated malware traffic to {target_ip}:{target_port} with payload '{payload}'...")
    source_ip = "10.0.0." + str(random.randint(1, 254))
    source_port = random.randint(1024, 65535)

    ip_layer = IP(src=source_ip, dst=target_ip)
    tcp_layer = TCP(sport=source_port, dport=target_port, flags="PA") # PSH, ACK flags
    raw_layer = Raw(load=payload.encode())
    packet = ip_layer / tcp_layer / raw_layer
    send(packet, verbose=0)
    print("Simulated malware traffic generation complete.")

if __name__ == "__main__":
    # Example usage: Send a packet with a specific malware signature
    generate_malware_traffic("192.168.1.100", 80, "MALWARE_SIGNATURE_TEST")
